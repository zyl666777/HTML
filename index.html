<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>è–èª•æ­Œæˆ° - å®˜æ–¹ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: radial-gradient(circle, #1a472a 0%, #0a2a16 100%);
            color: white;
            min-height: 100vh;
            margin: 0;
            overflow-x: hidden;
        }

        /* å°è¦½åˆ‡æ› */
        .nav-tab {
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
            opacity: 0.6;
        }
        .nav-tab.active {
            color: #ffd700;
            border-bottom: 3px solid #ffd700;
            opacity: 1;
        }

        /* æŠ½å¡æ©Ÿæ¨£å¼ */
        .card-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            perspective: 1000px;
        }
        .card-container { aspect-ratio: 2 / 3; cursor: pointer; position: relative; width: 100%; }
        .card-inner {
            position: relative; width: 100%; height: 100%;
            transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            transform-style: preserve-3d;
        }
        .card-container.flipped .card-inner { transform: rotateY(180deg); }
        .card-front, .card-back {
            position: absolute; width: 100%; height: 100%;
            backface-visibility: hidden; border-radius: 8px;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            border: 1.5px solid #ffd700;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        .card-back { 
            background: linear-gradient(135deg, #c41e3a 0%, #800e13 100%); 
            z-index: 2;
        }
        .card-back::after { content: "ğŸ"; font-size: 1.5rem; }
        .card-front { 
            background: white; 
            color: #333; 
            transform: rotateY(180deg); 
            padding: 8px; 
            text-align: center; 
        }

        /* çµç®—è¡¨æ¨£å¼ */
        input[type="number"] {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 10px;
            color: white;
            text-align: center;
            width: 100%;
            font-size: 1.1rem;
            font-weight: bold;
        }

        /* Modal æ¨£å¼ */
        #resultModal, #winnerModal {
            position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 500;
            display: none; flex-direction: column; align-items: center; justify-content: center;
            padding: 20px;
            backdrop-filter: blur(10px);
        }

        .btn-action {
            background: #c41e3a;
            color: white;
            padding: 12px 30px;
            border-radius: 99px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(196, 30, 58, 0.4);
            margin-top: 20px;
            transition: transform 0.1s;
        }
        .btn-action:active { transform: scale(0.95); }
    </style>
</head>
<body>

    <audio id="audioFlip" src="https://assets.mixkit.co/active_storage/sfx/2017/2017-preview.mp3" preload="auto"></audio>

    <!-- é ‚éƒ¨å°è¦½ -->
    <nav class="flex justify-center gap-8 bg-black/60 backdrop-blur-md py-4 sticky top-0 z-[100] border-b border-white/10">
        <button onclick="switchPage('game')" id="tab-game" class="nav-tab active font-bold px-4 pb-1 text-lg">ğŸ² å‘½é‹æŠ½å¡</button>
        <button onclick="switchPage('results')" id="tab-results" class="nav-tab font-bold px-4 pb-1 text-lg">ğŸ† äº”å ´æˆ°å ±</button>
    </nav>

    <!-- é é¢ 1: æŠ½å¡æ©Ÿ -->
    <main id="page-game" class="flex flex-col items-center p-4 max-w-lg mx-auto">
        <!-- åƒ…ä¿ç•™æ¨™é¡Œæ–‡å­— -->
        <div class="header-text w-full text-center mb-8 mt-6">
            <h1 class="text-3xl font-black text-yellow-500 tracking-[0.2em] drop-shadow-lg">è–èª•ç´…ç™½å¤§è³½</h1>
            <div class="h-1 w-24 bg-red-600 mx-auto mt-2 rounded-full"></div>
        </div>

        <div id="statusText" class="text-yellow-400/80 font-bold mb-4 animate-pulse text-sm">è«‹é»æ“Šæ´—ç‰Œé–‹å§‹éŠæˆ²</div>
        
        <div class="card-grid w-full mb-10" id="cardGrid"></div>

        <div class="flex flex-col items-center gap-4 w-full">
            <button id="shuffleBtn" onclick="shuffleCards()" class="bg-[#c41e3a] hover:bg-red-700 active:scale-95 w-full py-4 rounded-full text-white font-black text-xl shadow-xl transition-all">ğŸ² é‡æ–°æ´—ç‰Œ</button>
            <p class="text-[10px] text-gray-500">é»æ“Šå¡ç‰‡å³å¯æ­æ›‰å‘½é‹</p>
        </div>
    </main>

    <!-- é é¢ 2: äº”å›åˆçµç®— -->
    <main id="page-results" class="hidden flex flex-col items-center p-4 max-w-lg mx-auto">
        <div class="w-full bg-white/5 p-6 rounded-3xl border border-white/10 mt-4">
            <h2 class="text-center text-yellow-500 font-black text-2xl mb-6">ç¸½æ±ºè³½è¨ˆåˆ†è¡¨</h2>
            <div class="grid grid-cols-3 gap-4 mb-4 text-center text-sm font-bold text-gray-400">
                <div>ROUND</div><div class="text-red-500">RED</div><div class="text-green-500">GREEN</div>
            </div>
            <div id="roundsInputs" class="space-y-4"></div>
            
            <div class="grid grid-cols-3 gap-4 mt-10 pt-6 border-t-2 border-yellow-500/50 text-center">
                <div class="text-yellow-500 font-black text-xl">TOTAL</div>
                <div id="total-red" class="text-3xl font-black text-red-500">0</div>
                <div id="total-green" class="text-3xl font-black text-green-500">0</div>
            </div>
            
            <button onclick="checkFinalWinner()" class="w-full mt-10 bg-yellow-600 hover:bg-yellow-500 py-4 rounded-2xl text-black font-black text-xl shadow-2xl transition-all">ğŸ† æ­æ›‰æœ€çµ‚è´å®¶</button>
        </div>
    </main>

    <!-- å„ç¨® Modals -->
    <div id="resultModal">
        <div class="bg-white/10 p-8 rounded-3xl border border-white/20 text-center max-w-xs w-full">
            <div id="modalRarity" class="text-xs font-bold px-3 py-1 rounded-full mb-4 inline-block"></div>
            <div id="modalTitle" class="text-4xl font-black mb-4 text-white leading-tight"></div>
            <div id="modalDesc" class="text-gray-300 mb-8 text-lg"></div>
            <div id="modalActionArea"></div>
            <button onclick="closeModal()" class="mt-12 text-gray-500 text-sm underline">è¿”å›å®®æ ¼</button>
        </div>
    </div>

    <div id="winnerModal">
        <div class="text-9xl mb-6">ğŸ‘‘</div>
        <div id="winnerName" class="text-6xl font-black mb-4 text-yellow-500"></div>
        <div id="winnerFinalScore" class="text-3xl font-mono mb-12 text-white"></div>
        <button onclick="location.reload()" class="bg-red-600 px-12 py-4 rounded-full font-black text-xl">é–‹å•Ÿæ–°è³½å­£</button>
    </div>

    <script>
        function switchPage(page) {
            document.getElementById('page-game').classList.toggle('hidden', page !== 'game');
            document.getElementById('page-results').classList.toggle('hidden', page !== 'results');
            document.getElementById('tab-game').classList.toggle('active', page === 'game');
            document.getElementById('tab-results').classList.toggle('active', page === 'results');
        }

        const roundsInputs = document.getElementById('roundsInputs');
        for (let i = 1; i <= 5; i++) {
            roundsInputs.innerHTML += `
                <div class="grid grid-cols-3 gap-4 items-center">
                    <div class="text-gray-500 font-bold italic">R${i}</div>
                    <input type="number" class="r-in" placeholder="0" oninput="calc()">
                    <input type="number" class="g-in" placeholder="0" oninput="calc()">
                </div>
            `;
        }

        function calc() {
            let r = 0, g = 0;
            document.querySelectorAll('.r-in').forEach(i => r += parseInt(i.value)||0);
            document.querySelectorAll('.g-in').forEach(i => g += parseInt(i.value)||0);
            document.getElementById('total-red').innerText = r;
            document.getElementById('total-green').innerText = g;
        }

        function checkFinalWinner() {
            const r = parseInt(document.getElementById('total-red').innerText);
            const g = parseInt(document.getElementById('total-green').innerText);
            if(r===0 && g===0) return alert("è«‹å…ˆè¼¸å…¥æ¯”è³½åˆ†æ•¸ï¼");
            document.getElementById('winnerName').innerText = r > g ? "ç´…éšŠè´äº†ï¼" : (g > r ? "ç¶ éšŠè´äº†ï¼" : "é›™æ–¹å¹³æ‰‹ï¼");
            document.getElementById('winnerFinalScore').innerText = `${r} : ${g}`;
            document.getElementById('winnerModal').style.display = 'flex';
        }

        const trapSongs = [
            { title: 'èˆå¥³', desc: 'ã€å¼·åˆ¶å‘½é‹ã€‘æ”¹å”±é€™é¦–ï¼Œä¸¦åŠ ä¸Šæ€§æ„Ÿèˆæ­¥ï¼', code: '40288' },
            { title: 'ä½ æ˜¯æˆ‘çš„èŠ±æœµ', desc: 'ã€å¼·åˆ¶å‘½é‹ã€‘å…¨å ´ä¸€èµ·è·³èŠ±æœµèˆï¼', code: '31045' },
            { title: 'é›æ”»æ“Šä¹‹è¡“', desc: 'ã€å¼·åˆ¶å‘½é‹ã€‘è¦ç”¨ã€Œé›ã€çš„è²éŸ³å”±ä¸€æ®µï¼', search: 'Chicken Attack' },
            { title: 'ä¿åº‡', desc: 'ã€å¼·åˆ¶å‘½é‹ã€‘å‰¯æ­Œè¦å®Œç¾é‡ç¾æ‰‹å‹¢ï¼', code: '12345' },
            { title: 'è½‰å§ä¸ƒå½©éœ“è™¹ç‡ˆ', desc: 'ã€å¼·åˆ¶å‘½é‹ã€‘å”±é€™é¦–æ™‚è¦å…¨å ´ç¹è‘—ä½ è½‰ï¼', code: '66688' }
        ];

        const cardPool = [
            { rarity: 'SSR', title: 'æ­Œç¥é‡‘å¡', desc: 'ç›´æ¥åŠ  50 åˆ†æˆ–ç²å¾—æ’æ’­æ¬Šï¼', color: 'bg-yellow-500 text-black' },
            { rarity: 'TRAP', title: 'å‘½é‹åè½‰', desc: 'æ­æ›‰ä½ çš„æƒ¡ææ­Œå–®...', color: 'bg-red-600 text-white' },
            { rarity: 'SR', title: 'é¦´é¹¿èˆä¼´', desc: 'åŠ  20 åˆ†ä¸¦æŒ‡å®šéšŠå‹ä¼´èˆã€‚', color: 'bg-indigo-500 text-white' },
            { rarity: 'TRAP', title: 'å‘½é‹åè½‰', desc: 'æ­æ›‰ä½ çš„æƒ¡ææ­Œå–®...', color: 'bg-red-600 text-white' },
            { rarity: 'SR', title: 'å¤©ä½¿åˆè²', desc: 'åŠ  20 åˆ†ã€‚', color: 'bg-indigo-500 text-white' },
            { rarity: 'R', title: 'è–èª•å¸½å’’', desc: 'åŠ  10 åˆ†ä½†è¦æˆ´å¸½å­å”±ã€‚', color: 'bg-orange-500 text-white' },
            { rarity: 'TRAP', title: 'å‘½é‹åè½‰', desc: 'æ­æ›‰ä½ çš„æƒ¡ææ­Œå–®...', color: 'bg-red-600 text-white' },
            { rarity: 'R', title: 'é‡ç¦®æŒ‘æˆ°', desc: 'åŠ  10 åˆ†ã€‚', color: 'bg-orange-500 text-white' },
            { rarity: 'R', title: 'å‡éŸ³é›ªèŠ±', desc: 'åŠ  10 åˆ†ã€‚', color: 'bg-orange-500 text-white' },
            { rarity: 'R', title: 'è½‰åœˆé›ªçƒ', desc: 'åŠ  10 åˆ†ã€‚', color: 'bg-orange-500 text-white' },
            { rarity: 'R', title: 'éœé»˜è–èª•', desc: 'åŠ  10 åˆ†ã€‚', color: 'bg-orange-500 text-white' },
            { rarity: 'R', title: 'æ­¡æ¨‚é Œ', desc: 'åŠ  10 åˆ†ã€‚', color: 'bg-orange-500 text-white' }
        ];

        let currentCards = [];
        let canFlip = false;
        let isShuffling = false;

        function initCards() {
            const grid = document.getElementById('cardGrid');
            grid.innerHTML = '';
            for(let i=0; i<12; i++) {
                grid.innerHTML += `
                    <div class="card-container" onclick="handleFlip(${i})" id="c-${i}">
                        <div class="card-inner">
                            <div class="card-back"></div>
                            <div class="card-front" id="f-${i}">
                                <div class="rarity text-[10px] font-bold px-2 py-0.5 rounded-full mb-2"></div>
                                <div class="title font-bold text-sm mb-1"></div>
                                <div class="desc text-[10px] text-gray-500 leading-tight"></div>
                            </div>
                        </div>
                    </div>`;
            }
        }

        function shuffleCards() {
            if (isShuffling) return;
            isShuffling = true;
            canFlip = false;
            document.querySelectorAll('.card-container').forEach(c => c.classList.remove('flipped'));
            document.getElementById('statusText').innerText = "æ´—ç‰Œä¸­...";
            setTimeout(() => {
                currentCards = [...cardPool].sort(() => Math.random() - 0.5);
                currentCards.forEach((data, i) => {
                    const front = document.getElementById(`f-${i}`);
                    if (front) {
                        const rarityEl = front.querySelector('.rarity');
                        rarityEl.innerText = data.rarity;
                        rarityEl.className = `rarity text-[10px] font-bold px-2 py-0.5 rounded-full mb-2 ${data.color}`;
                        front.querySelector('.title').innerText = data.title;
                        front.querySelector('.desc').innerText = data.desc;
                    }
                });
                canFlip = true;
                isShuffling = false;
                document.getElementById('statusText').innerText = "ğŸŒŸ è«‹é¸æ“‡ä¸€å¼µå‘½é‹å¡ ğŸŒŸ";
            }, 600);
        }

        function handleFlip(i) {
            if(!canFlip || isShuffling) return;
            const card = document.getElementById(`c-${i}`);
            if(!card || card.classList.contains('flipped')) return;
            const flipAudio = document.getElementById('audioFlip');
            if (flipAudio) flipAudio.play().catch(()=>{});
            card.classList.add('flipped');
            let data = {...currentCards[i]};
            if(data.rarity === 'TRAP') {
                const song = trapSongs[Math.floor(Math.random() * trapSongs.length)];
                data.title = song.title;
                data.desc = song.desc;
                data.code = song.code;
                data.search = song.search;
                const front = document.getElementById(`f-${i}`);
                if (front) {
                    front.querySelector('.title').innerText = data.title;
                    front.querySelector('.desc').innerText = data.desc;
                }
            }
            setTimeout(() => showResultModal(data), 800);
        }

        function showResultModal(data) {
            const modal = document.getElementById('resultModal');
            const rarity = document.getElementById('modalRarity');
            rarity.innerText = data.rarity === 'TRAP' ? "ğŸš¨ å‘½é‹æ›²ç›®" : data.rarity;
            rarity.className = `text-xs font-bold px-3 py-1 rounded-full mb-4 inline-block ${data.color}`;
            document.getElementById('modalTitle').innerText = data.title;
            document.getElementById('modalDesc').innerText = data.desc;
            const area = document.getElementById('modalActionArea');
            area.innerHTML = '';
            if(data.code || data.search) {
                const btn = document.createElement('button');
                btn.className = 'btn-action';
                btn.innerText = data.code ? `ğŸ¤ KTV ç·¨è™Ÿï¼š${data.code}` : `ğŸ“º æœå°‹ YouTube`;
                btn.onclick = () => {
                    const q = data.search || data.title;
                    window.open(`https://www.youtube.com/results?search_query=${encodeURIComponent(q)}`, '_blank');
                };
                area.appendChild(btn);
            }
            modal.style.display = 'flex';
        }

        function closeModal() { document.getElementById('resultModal').style.display = 'none'; }

        window.onload = () => {
            initCards();
            shuffleCards();
        };
    </script>
</body>
</html>